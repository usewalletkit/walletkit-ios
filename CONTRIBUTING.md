# Contributing

## Generation

Part of the SDK is generated by the [OpenAPI Generator](https://openapi-generator.tech) project with an [openapi-spec](https://github.com/OAI/OpenAPI-Specification).

Running `./generate.sh` will generate the code with the latest OpenAPI spec from [usewalletkit/api](https://github.com/usewalletkit/api). Make sure you install [OpenAPI Generator CLI](https://openapi-generator.tech/docs/installation#homebrew) before generation.

## Continuous Integration

Pushing or opening a pull request to `main` branch will trigger the `swift.yml` automation workflow to build and test the Swift project.

## Distribution

To distribute a new version of the SDK to Swift Pacakge Manager and CocoaPods, follow the steps below:

1. Commit changes and push to the repository, including generated code and any other needed changes.
2. Create a tag with `git tag x.y.z`. Note that there's no `v` prefix.
3. Run `git push origin x.y.z` to push to remote.

### Swift Package Manager

Pushing the tag to remote itself is sufficient to make the new version visible to Swift Package Manager.

### CocoaPods

Pushing the tag to remote will trigger the `cocoapods.yml` automation workflow to publish the SDK to CocoaPods.

The `cocoapods.yml` automation workflow will fetch the tag and use it as the `WALLET_KIT_VERSION` in `WalletKit.podspec`, followed by `pod spec lint` to validate the podspec and `pod trunk push` to publish the new version to [CocoaPods.org](https://cocoapods.org).

The automation relies on the `COCOAPODS_TRUNK_TOKEN` secret, which is a CocoaPods Trunk session token that will be expired every 150 days. To register a new session, you can run `pod trunk register info@usewalletkit.com 'WalletKit'` and then click the verification link in the email. Running `pod trunk me` will list out all the sessions. To find the session token, you can run `pod trunk me --verbose` and locate `Token XXXXXXXX`, or run `pod trunk me --verbose | grep -Eo 'Token [A-Za-z0-9]+' | awk '{print $2}'` to print out the token directly.

After publishing the new version to [CocoaPods.org](https://cocoapods.org), you can verify by checking the CocoaPods webpage: https://cocoapods.org/pods/WalletKit or running `pod repo update && pod search --simple --ios WalletKit`.
